<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IT Ops Task Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-6">
    <h1 class="text-2xl font-bold text-center mb-6">IT Ops Task Generator</h1>

    <!-- Daily Tasks -->
    <div class="mb-6 p-4 border rounded-xl shadow-sm">
      <h2 class="text-xl font-semibold mb-3 text-blue-700">Daily Tasks</h2>
      <div id="dailyTasksList" class="space-y-2"></div>
      <button onclick="toggleEditTasks()" class="mt-3 px-4 py-2 bg-gray-200 rounded-lg">Edit Task Pool</button>
      <div id="editTasksSection" class="mt-3 hidden">
        <textarea id="editTasksArea" rows="6" class="w-full border rounded-lg p-2"></textarea>
        <button onclick="saveTasks()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg">Save Task Pool</button>
      </div>
    </div>

    <!-- Weekly Tasks -->
    <div class="mb-6 p-4 border rounded-xl shadow-sm">
      <h2 class="text-xl font-semibold mb-3 text-green-700">Weekly Tasks</h2>
      <textarea id="weeklyTasks" rows="4" class="w-full border rounded-lg p-2"></textarea>
    </div>

    <!-- Monthly Tasks -->
    <div class="mb-6 p-4 border rounded-xl shadow-sm">
      <h2 class="text-xl font-semibold mb-3 text-purple-700">Monthly Tasks</h2>
      <textarea id="monthlyTasks" rows="4" class="w-full border rounded-lg p-2"></textarea>
    </div>

    <!-- Monitoring -->
    <div class="mb-6 p-4 border rounded-xl shadow-sm">
      <h2 class="text-xl font-semibold mb-3 text-red-700">Monitoring</h2>
      <label class="block mb-2">Mode:</label>
      <select id="monitoringMode" onchange="toggleMonitoringMode()" class="border rounded-lg p-2">
        <option value="auto">Auto Divide</option>
        <option value="manual">Manual Input</option>
      </select>

      <div id="autoDivideSection" class="mt-4">
        <label class="block mb-1">Start Time:</label>
        <input type="time" id="startTime" value="06:30" class="border rounded-lg p-2 w-full">
        <label class="block mb-1 mt-2">End Time:</label>
        <input type="time" id="endTime" value="14:30" class="border rounded-lg p-2 w-full">
        <label class="block mb-1 mt-2">Team Members (2-6):</label>
        <input type="number" id="teamCount" min="2" max="6" value="4" class="border rounded-lg p-2 w-full">
        <button onclick="generateMonitoring()" class="mt-3 px-4 py-2 bg-gray-300 rounded-lg">Generate Slots</button>
        <div id="autoMonitoringSlots" class="mt-3 space-y-2"></div>
      </div>

      <div id="manualSection" class="mt-4 hidden">
        <textarea id="manualMonitoring" rows="4" placeholder="Enter custom monitoring slots (e.g., 06:30-08:30)" class="w-full border rounded-lg p-2"></textarea>
        <button onclick="generateManualMonitoring()" class="mt-3 px-4 py-2 bg-gray-300 rounded-lg">Apply Manual Slots</button>
        <div id="manualMonitoringSlots" class="mt-3 space-y-2"></div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="text-center mb-6 space-x-4">
      <button onclick="generateOutput()" class="px-6 py-3 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700">Generate Output</button>
      <button onclick="resetAll()" class="px-6 py-3 bg-red-500 text-white rounded-xl shadow-lg hover:bg-red-600">Reset All</button>
    </div>

    <!-- Output -->
    <div class="p-4 border rounded-xl shadow-sm bg-gray-50">
      <h2 class="text-xl font-semibold mb-3">Generated Output</h2>
      <pre id="output" class="whitespace-pre-wrap"></pre>
    </div>
  </div>

<script>
  const STORAGE_KEY = "itops-task-generator";

  const members = {
    "IRO": "Ian Romero",
    "RDE": "Rhizza De Guzman",
    "FFA": "Felix Factor",
    "NLA": "Nathan Lapena",
    "MAG": "Michael Henry Aglubat",
    "JMA": "Jelyn Malubay"
  };

  let taskPool = [
    "PW", "ARC", "Loglogic", "TM1Top", "ISMS", "CRITICAL",
    "PROXY", "HO", "EMEA Ticket", "TO", "Remind AX"
  ];

  // --- Persistence ---
  function saveState() {
    const state = {
      tasks: [],
      weekly: document.getElementById("weeklyTasks").value,
      monthly: document.getElementById("monthlyTasks").value,
      monitoringMode: document.getElementById("monitoringMode").value,
      manualSlots: document.getElementById("manualMonitoring").value
    };

    document.querySelectorAll("#dailyTasksList div").forEach(row => {
      const cb = row.querySelector("input[type=checkbox]");
      const dd = row.querySelector("select");
      state.tasks.push({task: cb.dataset.task, checked: cb.checked, member: dd.value});
    });

    if (state.monitoringMode === "auto") {
      state.autoSlots = [];
      document.querySelectorAll("#autoMonitoringSlots select").forEach(sel => {
        state.autoSlots.push({slot: sel.dataset.slot, member: sel.value});
      });
    } else {
      state.manualAssigned = [];
      document.querySelectorAll("#manualMonitoringSlots select").forEach(sel => {
        state.manualAssigned.push({slot: sel.dataset.slot, member: sel.value});
      });
    }

    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const state = JSON.parse(raw);

    document.getElementById("weeklyTasks").value = state.weekly || "";
    document.getElementById("monthlyTasks").value = state.monthly || "";
    document.getElementById("monitoringMode").value = state.monitoringMode || "auto";
    toggleMonitoringMode();

    renderDailyTasks(state.tasks);

    if (state.monitoringMode === "auto" && state.autoSlots) {
      generateMonitoring();
      setTimeout(()=>{
        document.querySelectorAll("#autoMonitoringSlots select").forEach((sel,i)=>{
          if (state.autoSlots[i]) sel.value = state.autoSlots[i].member;
        });
      },100);
    } else if (state.monitoringMode === "manual") {
      document.getElementById("manualMonitoring").value = state.manualSlots || "";
      generateManualMonitoring();
      setTimeout(()=>{
        document.querySelectorAll("#manualMonitoringSlots select").forEach((sel,i)=>{
          if (state.manualAssigned[i]) sel.value = state.manualAssigned[i].member;
        });
      },100);
    }
  }

  // --- Daily Tasks ---
  function renderDailyTasks(saved=[]) {
    const container = document.getElementById("dailyTasksList");
    container.innerHTML = "";
    taskPool.forEach(task => {
      const row = document.createElement("div");
      row.className = "flex items-center space-x-2";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.className = "form-checkbox";
      checkbox.dataset.task = task;
      checkbox.onchange = saveState;

      const label = document.createElement("span");
      label.textContent = task;

      const dropdown = document.createElement("select");
      dropdown.className = "border rounded-lg p-1";
      dropdown.dataset.task = task;
      dropdown.innerHTML = `<option value="">-- Select Member --</option>` +
        Object.entries(members).map(([k,v]) => `<option value="${k}">${k} (${v})</option>`).join("");
      dropdown.onchange = saveState;

      const savedTask = saved.find(t=>t.task===task);
      if (savedTask) {
        checkbox.checked = savedTask.checked;
        dropdown.value = savedTask.member;
      }

      row.appendChild(checkbox);
      row.appendChild(label);
      row.appendChild(dropdown);
      container.appendChild(row);
    });
  }

  function toggleEditTasks() {
    document.getElementById("editTasksArea").value = taskPool.join("\n");
    document.getElementById("editTasksSection").classList.toggle("hidden");
  }

  function saveTasks() {
    const newTasks = document.getElementById("editTasksArea").value.split("\n").map(t => t.trim()).filter(t => t);
    if (newTasks.length) taskPool = newTasks;
    renderDailyTasks();
    document.getElementById("editTasksSection").classList.add("hidden");
    saveState();
  }

  // --- Monitoring ---
  function toggleMonitoringMode() {
    const mode = document.getElementById("monitoringMode").value;
    document.getElementById("autoDivideSection").classList.toggle("hidden", mode !== "auto");
    document.getElementById("manualSection").classList.toggle("hidden", mode !== "manual");
    saveState();
  }

  function formatTime(date) {
    let h = date.getHours(), m = date.getMinutes();
    const ampm = h >= 12 ? "PM" : "AM";
    h = h % 12 || 12;
    return h + ":" + (m<10?"0":"") + m + " " + ampm;
  }

  function generateMonitoring() {
    const start = document.getElementById("startTime").value;
    const end = document.getElementById("endTime").value;
    const count = parseInt(document.getElementById("teamCount").value);
    const slotsDiv = document.getElementById("autoMonitoringSlots");
    slotsDiv.innerHTML = "";
    const [sh,sm] = start.split(":"), [eh,em] = end.split(":");
    let cur = new Date(); cur.setHours(sh,sm);
    let endDate = new Date(); endDate.setHours(eh,em);
    const total = (endDate - cur) / 60000;
    const slotMins = total / count;
    for (let i=0;i<count;i++) {
      let s = new Date(cur);
      cur.setMinutes(cur.getMinutes()+slotMins);
      let e = new Date(cur);
      const row = document.createElement("div");
      row.className = "flex items-center space-x-2";
      const label = document.createElement("span");
      label.textContent = `${formatTime(s)} - ${formatTime(e)}`;
      const dropdown = document.createElement("select");
      dropdown.className = "border rounded-lg p-1";
      dropdown.dataset.slot = `${formatTime(s)} - ${formatTime(e)}`;
      dropdown.innerHTML = `<option value="">-- Select Member --</option>` +
        Object.entries(members).map(([k,v]) => `<option value="${k}">${k} (${v})</option>`).join("");
      dropdown.onchange = saveState;
      row.appendChild(label);
      row.appendChild(dropdown);
      slotsDiv.appendChild(row);
    }
    saveState();
  }

  function generateManualMonitoring() {
    const slots = document.getElementById("manualMonitoring").value.split("\n").map(s=>s.trim()).filter(s=>s);
    const container = document.getElementById("manualMonitoringSlots");
    container.innerHTML = "";
    slots.forEach(slot => {
      const row = document.createElement("div");
      row.className = "flex items-center space-x-2";
      const label = document.createElement("span");
      label.textContent = slot;
      const dropdown = document.createElement("select");
      dropdown.className = "border rounded-lg p-1";
      dropdown.dataset.slot = slot;
      dropdown.innerHTML = `<option value="">-- Select Member --</option>` +
        Object.entries(members).map(([k,v]) => `<option value="${k}">${k} (${v})</option>`).join("");
      dropdown.onchange = saveState;
      row.appendChild(label);
      row.appendChild(dropdown);
      container.appendChild(row);
    });
    saveState();
  }

  // --- Output ---
  function generateOutput() {
    let out = "Date: " + new Date().toISOString().slice(0,10) + "\n\n";

    out += "DAILY TASKS:\n";
    document.querySelectorAll("#dailyTasksList div").forEach(row => {
      const cb = row.querySelector("input[type=checkbox]");
      const dd = row.querySelector("select");
      if (cb.checked && dd.value) {
        out += `- ${cb.dataset.task} — ${dd.value} (${members[dd.value]})\n`;
      }
    });
    out += "\nWEEKLY TASKS:\n" + (document.getElementById("weeklyTasks").value.trim()||"(None)") + "\n\n";
    out += "MONTHLY TASKS:\n" + (document.getElementById("monthlyTasks").value.trim()||"(None)") + "\n\n";
    out += "MONITORING:\n";
    if (document.getElementById("monitoringMode").value==="manual") {
      document.querySelectorAll("#manualMonitoringSlots select").forEach(sel=>{
        if (sel.value) out += `- ${sel.dataset.slot} — ${sel.value} (${members[sel.value]})\n`;
      });
    } else {
      document.querySelectorAll("#autoMonitoringSlots select").forEach(sel=>{
        if (sel.value) out += `- ${sel.dataset.slot} — ${sel.value} (${members[sel.value]})\n`;
      });
    }

    document.getElementById("output").textContent = out;
    saveState();
  }

  // --- Reset All ---
  function resetAll() {
    if (confirm("Are you sure you want to reset all tasks for a new day?")) {
      localStorage.removeItem(STORAGE_KEY);
      document.getElementById("weeklyTasks").value = "";
      document.getElementById("monthlyTasks").value = "";
      document.getElementById("manualMonitoring").value = "";
      renderDailyTasks();
      document.getElementById("autoMonitoringSlots").innerHTML = "";
      document.getElementById("manualMonitoringSlots").innerHTML = "";
      document.getElementById("output").textContent = "";
    }
  }

  // Init
  renderDailyTasks();
  loadState();
  document.getElementById("weeklyTasks").addEventListener("input", saveState);
  document.getElementById("monthlyTasks").addEventListener("input", saveState);
  document.getElementById("manualMonitoring").addEventListener("input", saveState);
</script>
</body>
</html>
